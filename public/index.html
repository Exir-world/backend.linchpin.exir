<!DOCTYPE html>
<html lang="fa">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FCM Notification Listener</title>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-messaging-compat.js"></script>
</head>

<body>
    <h1>ğŸ“² ØªØ³Øª Ù†ÙˆØªÛŒÙ ÙØ§ÛŒØ±Ø¨ÛŒØ³</h1>
    <p id="token">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª ØªÙˆÚ©Ù†...</p>
    <p id="log"></p>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDcrm65-rQHOoLKNtPTwI-cOm851c1X3SU",
            authDomain: "linchpin-9c906.firebaseapp.com",
            projectId: "linchpin-9c906",
            storageBucket: "linchpin-9c906.firebasestorage.app",
            messagingSenderId: "200118688766",
            appId: "1:200118688766:web:970a436e624f6320853eaf",
            measurementId: "G-FV1MHWWEEJ"
        };

        firebase.initializeApp(firebaseConfig);
        const messaging = firebase.messaging();

        async function initFCM() {
            try {
                const permission = await Notification.requestPermission();
                if (permission !== 'granted') {
                    document.getElementById('log').innerText = 'âŒ Ø§Ø¬Ø§Ø²Ù‡ Ø§Ø±Ø³Ø§Ù„ Ù†ÙˆØªÛŒÙ Ø¯Ø§Ø¯Ù‡ Ù†Ø´Ø¯.';
                    return;
                }

                const registration = await navigator.serviceWorker.register('./firebase-messaging-sw.js');

                const token = await messaging.getToken({
                    vapidKey: 'BNYTnaaqgO6EjKRQy3dCwOtGNMdisGe0x_uUyikHLo7vRNb62muMOjcILcQUa1fuOo0wPhFLScibev4_eFZL_PM',
                    serviceWorkerRegistration: registration // âœ… ÙÙ‚Ø· Ø§ÛŒÙ† Ú©Ø§ÙÛŒÙ‡
                });

                document.getElementById('token').innerText = `âœ… ØªÙˆÚ©Ù† Ø´Ù…Ø§: ${token}`;
                console.log('FCM Token:', token);

                messaging.onMessage((payload) => {
                    console.log('ğŸ”” Ù¾ÛŒØ§Ù… Ø¯Ø±ÛŒØ§ÙØªÛŒ:', payload);

                    const { title, body } = payload.notification;
                    new Notification(title, { body });

                    document.getElementById('log').innerText = `ğŸ”” ${title}: ${body}`;
                });

            } catch (err) {
                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª FCM:', err);
                document.getElementById('log').innerText = `âŒ ${err.message}`;
            }
        }

        initFCM();
    </script>
</body>

</html>